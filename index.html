<!DOCTYPE html>
<html lang="de">
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#22c55e">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Abrechnungsprogramm</title>

  <!-- OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

  <!-- PDF.js -->
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js";
  </script>

  <!-- XLSX -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <link rel="stylesheet" href="css/styles.css">
  <script defer src="js/app.js"></script>
</head>

<body>
<div class="container">

<header>
  <h1>ğŸ“¦ Abrechnungsprogramm</h1>
  <small><b>Bismillah</b> â€“ Im Namen Allahs, des Allerbarmers, des Barmherzigen</small>
</header>

<!-- ================== PAKETE ================== -->
<div class="section">
  <div class="accordion" onclick="togglePkg()" aria-expanded="false">ğŸ“¦ Pakete verwalten</div>
  <div id="pkgContent" class="accordion-content">

    <div class="row">
      <label>Name</label>
      <input id="pn" placeholder="z.B. Paket A">
    </div>

    <div class="row">
      <label>Preis â‚¬</label>
      <input id="pp" type="number" inputmode="decimal" placeholder="z.B. 12.50">
    </div>

    <div class="row">
      <label>Keywords</label>
      <input id="pk" placeholder="kommagetrennt, z.B. Apfel,Banane">
    </div>

    <div class="row" style="gap:10px;">
      <div style="flex:1">
        <label>Symbol</label>
        <button id="symbolBtn" type="button" onclick="openEmojiPicker()">ğŸ“¦</button>
      </div>
      <div style="flex:1">
        <label>Farbe</label>
        <input id="pc" type="color" value="#22c55e">
      </div>
    </div>

    <button class="primary" onclick="addPackage()">â• Paket</button>
    <button class="ghost" onclick="exportPackages()">â¬‡ Pakete exportieren</button>

    <input type="file" id="importFile" accept=".json" style="display:none"
           onchange="importPackages(this.files)">
    <button class="ghost" onclick="document.getElementById('importFile').click()">
      â¬† Pakete importieren
    </button>

    <div class="table-wrap">
      <table id="pkgTable"></table>
    </div>
  </div>
</div>

<!-- ================== GUTSCHRIFT ================== -->
<div class="section">
  <div class="accordion" onclick="toggleGutschrift()" aria-expanded="false">
    ğŸ“„ Gutschrift (PDF / XLSX)
  </div>

  <div id="gsContent" class="accordion-content" style="display:none">
    <input type="file" accept="application/pdf,.xlsx"
           onchange="importGutschrift(this.files)" style="width:100%">

    <button class="danger" onclick="clearGutschrift()" style="margin-top:8px;width:100%">
      ğŸ—‘ Gutschrift lÃ¶schen
    </button>

    <div id="gsDashboard" class="dashboard" style="margin-top:10px;"></div>
    <div id="gsTabs" class="tabs" style="margin-top:10px;"></div>

    <div class="table-wrap small-table">
      <table id="gsTable"></table>
    </div>
  </div>
</div>

<!-- ================== SCREENSHOTS ================== -->
<div class="section">
  <h2>1ï¸âƒ£ Screenshots</h2>

  <input
    type="file"
    multiple
    accept="image/jpeg,image/png,image/heic,image/heif"
    onchange="loadScreenshots(this.files)"
    style="width:100%"
  >

  <div class="progress">
    <div id="bar" class="progress-bar"></div>
  </div>
  <p id="progressText" class="helper"></p>
</div>

<!-- ================== ÃœBERSICHT ================== -->
<div class="section">
  <h2>2ï¸âƒ£ Ãœbersicht</h2>
  <div id="dashboard" class="dashboard"></div>
</div>

<!-- ================== AUFTRÃ„GE ================== -->
<div class="section">
  <h2>3ï¸âƒ£ AuftrÃ¤ge</h2>

  <div class="section">
    <div class="accordion" onclick="toggleManual()" aria-expanded="false">
      âœï¸ Manueller Eintrag
    </div>

    <div id="manualContent" class="accordion-content">
      <div class="row">
        <label>Datum</label>
        <input id="m_date" type="date">
      </div>

      <div class="row">
        <label>Zeitfenster</label>
        <select id="m_time"></select>
      </div>

      <div class="row">
        <label>Artikel / Beschreibung</label>
        <input id="m_artikel">
      </div>

      <div class="row">
        <label>Paket</label>
        <select id="m_package"></select>
      </div>

      <button class="primary" onclick="addManualEntry()">â• Eintrag hinzufÃ¼gen</button>
    </div>
  </div>

  <div id="tabs" class="tabs"></div>
  <div class="table-wrap small-table">
    <table id="orderTable"></table>
  </div>
</div>

<!-- ================== CONTROLS ================== -->
<div id="tabControls" class="section">
  <button class="danger" onclick="location.reload()">â™» Reset</button>

  <button class="ghost" onclick="exportCurrentTab()">â¬‡ğŸ’¾ Save</button>

  <input type="file" id="importTabFile" accept=".json" style="display:none"
         onchange="importCurrentTab(this.files)">
  <button class="ghost" onclick="document.getElementById('importTabFile').click()">
    â¬†ğŸ“ Load
  </button>
</div>

</div>

<!-- ================== SERVICE WORKER ================== -->
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./sw.js")
      .then(() => console.log("âœ… PWA Service Worker aktiv"))
      .catch(err => console.error("âŒ SW Fehler", err));
  });
}
</script>

</body>
</html>
