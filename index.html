<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Abrechnungsprogramm</title>

  <!-- OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

  <!-- PDF.js fÃ¼r Gutschrift -->
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js";
  </script>

  <!-- XLSX (SheetJS) fÃ¼r Gutschrift (Excel-Import) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <link rel="stylesheet" href="css/styles.css">
  <script defer src="js/app.js?"></script>

</head>

<body>
<div class="container">

<header>
  <h1>ğŸ“¦ Abrechnungsprogramm</h1>
  <small><b>Bismillah</b> â€“ Im Namen Allahs, des Allerbarmers, des Barmherzigen</small>
</header>

<!-- ================== PAKETE ================== -->
<div class="section">
  <div class="accordion" onclick="togglePkg()" aria-expanded="false">ğŸ“¦ Pakete verwalten</div>
  <div id="pkgContent" class="accordion-content">

    <div class="row">
      <label>Name</label>
      <input id="pn" placeholder="z.B. Paket A">
    </div>

    <div class="row">
      <label>Preis â‚¬</label>
      <input id="pp" type="number" inputmode="decimal" placeholder="z.B. 12.50">
    </div>

    <div class="row">
      <label>Keywords</label>
      <input id="pk" placeholder="kommagetrennt, z.B. Apfel,Banane">
    </div>

    <div class="row" style="gap:10px;">
      <div style="flex:1">
        <label>Symbol</label>
        <button id="symbolBtn" type="button" onclick="openEmojiPicker()">ğŸ“¦</button>
      </div>
      <div style="flex:1">
        <label>Farbe</label>
        <input id="pc" type="color" value="#22c55e">
      </div>
    </div>

    <button class="primary" onclick="addPackage()">â• Paket</button>
    <button class="ghost" onclick="exportPackages()">â¬‡ Pakete exportieren</button>

    <input type="file" id="importFile" accept=".json" style="display:none"
           onchange="importPackages(this.files)">
    <button class="ghost" onclick="document.getElementById('importFile').click()">
      â¬† Pakete importieren
    </button>

    <div class="table-wrap"><table id="pkgTable"></table></div>
  </div>
</div>

<!-- ================== ARBEIT (1â€“3) ================== -->
<div class="section">
  <div class="accordion" onclick="toggleWork()" aria-expanded="false">ğŸ§¾ Arbeit (1â€“3)</div>

  <div id="workContent" class="accordion-content" style="display:none">

    <!-- 1ï¸âƒ£ Screenshots -->
    <div class="inner-block">
      <div class="section-title">
        <h2>1ï¸âƒ£ Screenshot hochladen</h2>
        <span class="badge">JPG/PNG</span>
      </div>

      <label class="upload-card">
        <input class="file-input" type="file" multiple accept="image/jpeg,image/png,image/heic,image/heif"
               onchange="loadScreenshots(this.files)">
        <div class="upload-card-inner">
          <div class="upload-icon">â¬†ï¸</div>
          <div>
            <div class="upload-title">Bilder auswÃ¤hlen</div>
            <div class="upload-sub">Tippen zum AuswÃ¤hlen â€¢ Mehrere Bilder mÃ¶glich</div>
          </div>
        </div>
      </label>

      <div class="progress"><div id="bar" class="progress-bar"></div></div>
      <p id="progressText" class="helper"></p>
    </div>

    <!-- 2ï¸âƒ£ Ãœbersicht -->
    <div class="inner-block">
      <div class="section-title">
        <h2>2ï¸âƒ£ Ãœbersicht</h2>
        <span class="badge">Live</span>
      </div>
      <div id="dashboard" class="dashboard"></div>
    </div>

    <!-- 3ï¸âƒ£ AuftrÃ¤ge -->
    <div class="inner-block">
      <div class="section-title">
        <h2>3ï¸âƒ£ AuftrÃ¤ge</h2>
        <span class="badge">Tabelle</span>
      </div>

      <!-- Manueller Eintrag (Accordion) -->
      <div class="section" style="margin:10px 0 0; padding:12px;">
       <div class="accordion" onclick="toggleManual()" aria-expanded="false">âœï¸ Manueller Eintrag</div>
	   <div id="manualContent" class="accordion-content" style="display:none">
<div class="manual-card">
  <div class="manual-grid">

    <div class="row">
      <label>Datum</label>
      <input id="m_date" type="date">
    </div>

    <div class="row">
      <label>Zeitfenster</label>
      <select id="m_time"></select>
    </div>

    <div class="row">
      <label>Bestellnummer</label>
      <input id="m_order" inputmode="numeric" placeholder="z.B. 41141243698">
    </div>

    <div class="row full">
      <label>Artikel / Beschreibung</label>
      <input id="m_artikel">
    </div>

    <div class="row">
      <label>Paket</label>
      <select id="m_package"></select>
    </div>

  </div>

  <button class="primary" onclick="addManualEntry()" style="width:100%; margin-top:10px;">
    â• Eintrag hinzufÃ¼gen
  </button>
</div>

      </div>

      <div id="tabs" class="tabs"></div>
      <div class="table-wrap small-table">
        <table id="orderTable"></table>
      </div>
    </div>

  </div>
</div>




<!-- ================== CONTROLS ================== -->
<!-- ===== Arbeit Controls ===== -->
<div class="section" style="margin-top:10px;">
  <button class="danger" onclick="resetWork()">â™» Reset </button>

  <button class="ghost" onclick="saveWork()">â¬‡ğŸ’¾ Save </button>

  <input type="file" id="importWorkFile" accept=".json" style="display:none"
         onchange="loadWork(this.files)">
  <button class="ghost" onclick="document.getElementById('importWorkFile').click()">â¬†ğŸ“ Load </button>
</div>

<!-- ================== GUTSCHRIFT ================== -->
<div class="section">
  <div class="accordion" onclick="toggleGutschrift()" aria-expanded="false">ğŸ“„ Gutschrift (PDF / XLSX)</div>

  <div id="gsContent" class="accordion-content" style="display:none">
    <input type="file" accept="application/pdf,.xlsx" onchange="importGutschrift(this.files)" style="width:100%">
	<div class="progress"><div id="gsBar" class="progress-bar"></div></div>
<p id="gsProgressText" class="helper"></p>


    <button class="danger" onclick="clearGutschrift()" style="margin-top:8px;width:100%">
      ğŸ—‘ Gutschrift lÃ¶schen
    </button>

    <div id="gsDashboard" class="dashboard" style="margin-top:10px;"></div>
    <div id="gsTabs" class="tabs" style="margin-top:10px;"></div>

    <div class="table-wrap small-table">
      <table id="gsTable"></table>
    </div>
  </div>
</div>


<!-- ================== VERGLEICHSLISTE ================== -->
<div class="section">
  <div class="accordion" onclick="toggleCompare()" aria-expanded="false">ğŸ” Vergleichsliste</div>

  <div id="cmpContent" class="accordion-content" style="display:none">

    <p class="helper" style="margin-top:0">
      Vergleicht <b>AuftrÃ¤ge</b> mit <b>Gutschrift</b> anhand der <b>Bestellnr</b> und prÃ¼ft Preis-Abweichungen.
    </p>

    <button class="primary" onclick="runComparison()" style="width:100%">
      â–¶ Vergleich starten
    </button>
<div class="progress"><div id="cmpBar" class="progress-bar"></div></div>
<p id="cmpProgressText" class="helper"></p>

    <div id="cmpSummary" class="dashboard" style="margin-top:10px;"></div>
    <div id="cmpTabs" class="tabs" style="margin-top:10px;"></div>

    <div class="table-wrap small-table">
      <table id="cmpTable"></table>
    </div>

  </div>
</div>
</body>
</html>